# 时区修复说明

## 问题描述
页面中的时间显示存在时区问题，数据库中存储的 UTC 时间在页面上直接显示，没有转换为东8区（中国标准时间）。

## 修复方案

### 1. 创建统一的时间处理工具

文件：`src/lib/date-utils.ts`

所有时间格式化函数都使用 `Intl.DateTimeFormat` API，并指定 `timeZone: 'Asia/Shanghai'`：

```typescript
// 示例
formatDateTime("2024-12-26T06:30:45.000Z")
// 输出: "2024-12-26 14:30:45" (UTC+8)
```

### 2. 更新的页面

所有页面统一使用时间工具函数：

- ✅ 新闻列表页面 (`src/app/news/page.tsx`)
  - 新闻发布时间
  - 导出历史创建时间
  - 筛选条件中的日期范围

- ✅ 新闻详情页面 (`src/app/news/[id]/page.tsx`)
  - 发布时间
  - 爬取时间
  - 创建/更新时间

- ✅ 爬取任务页面 (`src/app/crawl/page.tsx`)
  - 任务开始时间
  - 任务耗时
  - 历史记录时间

- ✅ 用户管理页面 (`src/app/users/page.tsx`)
  - 创建时间
  - 最后登录时间

### 3. 时间格式化函数说明

| 函数名 | 输入示例 | 输出示例 | 用途 |
|--------|---------|---------|------|
| `formatDateTime()` | `2024-12-26T06:30:45.000Z` | `2024-12-26 14:30:45` | 完整日期时间 |
| `formatDate()` | `2024-12-26T06:30:45.000Z` | `2024-12-26` | 仅日期 |
| `formatDuration()` | `90` (分钟) | `1 小时 30 分钟` | 时长格式化 |
| `formatDurationFromDates()` | 起止时间 | `2 小时 30 分钟` | 计算时间差 |
| `formatRelativeTime()` | 时间戳 | `5分钟前` | 相对时间 |

### 4. 时区转换示例

**UTC 时间 -> 东8区时间：**

| UTC 时间 | 东8区时间 | 说明 |
|----------|----------|------|
| `2024-12-26 06:30:45` | `2024-12-26 14:30:45` | +8 小时 |
| `2024-12-25 23:00:00` | `2024-12-26 07:00:00` | 跨天 |
| `2024-12-26 00:00:00` | `2024-12-26 08:00:00` | 零点 |

## 验证

所有时间显示已统一使用东8区时间，包括：

1. ✅ 新闻列表的发布时间
2. ✅ 新闻详情的各项时间
3. ✅ 导出历史的创建时间
4. ✅ 爬取任务的开始时间和耗时
5. ✅ 用户的创建和登录时间

## 测试

运行测试验证时区转换：

```bash
npm test src/lib/__tests__/date-utils.test.ts
```

## 注意事项

1. 数据库中继续使用 UTC 时间存储（ISO 8601 格式）
2. 仅在前端展示时转换为东8区时间
3. 所有新页面都应使用 `src/lib/date-utils.ts` 中的函数
4. 不要再使用 `toLocaleString()` 或 `toLocaleDateString()`
